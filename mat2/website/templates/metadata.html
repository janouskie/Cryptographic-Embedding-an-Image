{% extends "base.html" %}
{% block title %}Metadata Tools{% endblock %}
{% block content %}
<div class="centered-form">
    <div class="form-card unique-meta-card">
        <div class="meta-icon">&#128247;</div>
        <h2 class="form-title gradient-text">Metadata Tools</h2>
        <form id="metaForm" enctype="multipart/form-data" onsubmit="return false;">
            <label for="file" class="meta-label">Upload Image:</label>
            <div class="custom-file-upload">
                <input type="file" id="file" name="file" accept="image/*" required>
                <label for="file" id="file-label">
                    <span id="file-label-text">&#128206; Choose Image</span>
                </label>
                <span id="file-chosen" class="file-chosen"></span>
            </div>
            <div class="button-group">
                <button type="button" class="btn meta-btn" id="display">&#128196; Display Metadata</button>
                <button type="button" class="btn meta-btn" id="datetime">&#128337; Show Date/Time</button>
                <button type="button" class="btn btn-danger meta-btn" id="remove">&#128465; Remove Metadata</button>
            </div>
            <div id="result"></div>
        </form>
    </div>
</div>
<script>
let selectedFile = null;

document.getElementById('file').addEventListener('change', function(e) {
    selectedFile = e.target.files[0];
    document.getElementById('file-chosen').textContent = selectedFile ? selectedFile.name : '';
});


// Input Validation error

function Meta(action) { // calls when user clicks a button
    if (!selectedFile) { // if not selected
        document.getElementById('result').innerHTML =
          "<div class='metadata-result unique-meta-result'><pre>Please select an image first.</pre></div>";
        return;
    }

    
    let formData = new FormData(); // action to perform display, datetime or remove feature
    formData.append('file', selectedFile);
    formData.append('action', action);

    fetch('/image-meta', { // to avoid reloading the page
        method: 'POST', //
        body: formData
    })
    .then(a => a.text()) // updates the page
    .then(html => {
        document.getElementById('result').innerHTML = html; // if successful
    })
    .catch(error => { 
        document.getElementById('result').innerHTML = 
        "<div class='metadata-result unique-meta-result'><pre>Error found: " + error + "</pre></div>";  // if failed
    });
}

document.getElementById('display').onclick = function() { Meta('display'); };
document.getElementById('datetime').onclick = function() { Meta('datetime'); };
document.getElementById('remove').onclick = function() { Meta('remove'); }; 

</script>
{% endblock %}

/* REFERENCES for javascript

1. https://www.youtube.com/watch?v=zUcc4vW-jsI&t=194s
2. https://www.youtube.com/watch?v=cei2Ch683q0&t=451s
3. https://stackoverflow.com/questions/68852641
4. https://www.w3schools.com/js/js_api_fetch.asp?
*/
